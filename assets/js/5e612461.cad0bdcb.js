"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[977],{8414:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>p,default:()=>_,frontMatter:()=>l,metadata:()=>u,toc:()=>k});var a=t(7462),r=t(7294),o=t(3905);const s=e=>{let{id:n}=e;return r.createElement("input",{type:"checkbox",id:n,onChange:()=>{const e=document.querySelector(`#${n}`);if(!(e instanceof HTMLInputElement))return;const t=document.querySelector(`#guide-${n}`);t instanceof HTMLElement&&(t.style.display=e.checked?"block":"none")}})},i=e=>{let{value:n}=e;return r.createElement("input",{type:"radio",name:"ci-provider",value:n,onChange:()=>{const e=document.querySelector("#guide-providers");if(!(e instanceof HTMLElement))return;const t=document.querySelector(`#guide-provider-${n}`);if(!(t instanceof HTMLElement))return;const a=document.querySelector("#guide-final-step");a instanceof HTMLElement&&(Array.from(e.children).forEach((e=>{e.style.display="none"})),t.style.display="block",a.style.display="block")}})},l={description:"Speed up your tests with optimal test suite parallelisation on your CI. Blog & documentation for Knapsack Pro.",hide_table_of_contents:!0,pagination_next:null,pagination_prev:null},p="Installation guide for ruby gem knapsack_pro",u={unversionedId:"knapsack_pro-ruby/guide/index",id:"knapsack_pro-ruby/guide/index",title:"Installation guide for ruby gem knapsack_pro",description:"Speed up your tests with optimal test suite parallelisation on your CI. Blog & documentation for Knapsack Pro.",source:"@site/docs/knapsack_pro-ruby/guide/index.md",sourceDirName:"knapsack_pro-ruby/guide",slug:"/knapsack_pro-ruby/guide/",permalink:"/knapsack_pro-ruby/guide/",draft:!1,editUrl:"https://github.com/KnapsackPro/docs.knapsackpro.com/tree/main/docusaurus/docs/knapsack_pro-ruby/guide/index.md",tags:[],version:"current",frontMatter:{description:"Speed up your tests with optimal test suite parallelisation on your CI. Blog & documentation for Knapsack Pro.",hide_table_of_contents:!0,pagination_next:null,pagination_prev:null},sidebar:"sidebar"},c={},k=[{value:"Installation",id:"installation",level:2},{value:"Questions",id:"questions",level:2},{value:"Step for RSpec",id:"step-for-rspec",level:3},{value:"Step for Minitest",id:"step-for-minitest",level:3},{value:"Step for test-unit",id:"step-for-test-unit",level:3},{value:"Step for Cucumber",id:"step-for-cucumber",level:3},{value:"Step for Spinach",id:"step-for-spinach",level:3},{value:"Step for VCR/WebMock/FakeWeb gems",id:"step-for-vcrwebmockfakeweb-gems",level:3},{value:"Step for CircleCI",id:"step-for-circleci",level:3},{value:"Step for Travis CI",id:"step-for-travis-ci",level:3},{value:"Step for Buildkite",id:"step-for-buildkite",level:3},{value:"Step for Semaphore CI",id:"step-for-semaphore-ci",level:3},{value:'Semaphore 2.0 <small>(<a href="#semaphore_1_0">click here for Semaphore 1.0</a>)</small>',id:"semaphore-20-click-here-for-semaphore-10",level:4},{value:"Step for CloudBees CodeShip",id:"step-for-cloudbees-codeship",level:3},{value:"Step for Heroku CI",id:"step-for-heroku-ci",level:3},{value:"Step for AppVeyor",id:"step-for-appveyor",level:3},{value:"Step for GitLab CI",id:"step-for-gitlab-ci",level:3},{value:"Step for Cirrus CI",id:"step-for-cirrus-ci",level:3},{value:"Step for Jenkins",id:"step-for-jenkins",level:3},{value:"Step for GitHub Actions",id:"step-for-github-actions",level:3},{value:"Step for Codefresh",id:"step-for-codefresh",level:3},{value:"Step for other CI providers",id:"step-for-other-ci-providers",level:3},{value:"Set API token",id:"set-api-token",level:3},{value:"Run tests on your CI servers",id:"run-tests-on-your-ci-servers",level:3},{value:"Verify that everything works in Regular Mode (step 1 out of 3)",id:"verify-that-everything-works-in-regular-mode-step-1-out-of-3",level:3},{value:"Consider using the Queue Mode to balance work dynamically across CI nodes (step 2 out of 3)",id:"consider-using-the-queue-mode-to-balance-work-dynamically-across-ci-nodes-step-2-out-of-3",level:3},{value:"How to split slow test files across parallel CI nodes (step 3 out of 3)",id:"how-to-split-slow-test-files-across-parallel-ci-nodes-step-3-out-of-3",level:3},{value:"Most popular FAQ entries",id:"most-popular-faq-entries",level:3}],d={toc:k};function _(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"installation-guide-for-ruby-gem-knapsack_pro"},"Installation guide for ruby gem knapsack_pro"),(0,o.kt)("p",null,"You can find more detailed information and configuration options in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/KnapsackPro/knapsack_pro-ruby"},"README for the knapsack_pro gem"),".",(0,o.kt)("br",null),"\n",(0,o.kt)("a",{parentName:"p",href:"http://knapsackpro.com?utm_source=docs_knapsackpro&utm_medium=page&utm_campaign=knapsack_pro-ruby_gem&utm_content=installation_guide"},"Create an account at Knapsack Pro to use the knapsack_pro gem")),(0,o.kt)("h2",{id:"installation"},"Installation"),(0,o.kt)("p",null,"Add the following code to your application's ",(0,o.kt)("inlineCode",{parentName:"p"},"Gemfile"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ruby"},"group :test, :development do\n  gem 'knapsack_pro'\nend\n")),(0,o.kt)("p",null,"And then execute:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"bundle install\n")),(0,o.kt)("p",null,"If you are not using Rails, then add this line at the bottom of your ",(0,o.kt)("inlineCode",{parentName:"p"},"Rakefile"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ruby"},"# Only needed if you are not using Rails.\nKnapsackPro.load_tasks if defined?(KnapsackPro)\n")),(0,o.kt)("h2",{id:"questions"},"Questions"),(0,o.kt)("p",null,"Please answer the following questions to get the basic ",(0,o.kt)("inlineCode",{parentName:"p"},"knapsack_pro")," configuration for your project."),(0,o.kt)("strong",null,"Choose your testing tools:"),(0,o.kt)("ul",{className:"none-list"},(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(s,{id:"test-runner-rspec",mdxType:"TestRunnerCheckbox"})," RSpec")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(s,{id:"test-runner-cucumber",mdxType:"TestRunnerCheckbox"})," Cucumber")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(s,{id:"test-runner-minitest",mdxType:"TestRunnerCheckbox"})," Minitest")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(s,{id:"test-runner-spinach",mdxType:"TestRunnerCheckbox"})," Spinach")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(s,{id:"test-runner-test-unit",mdxType:"TestRunnerCheckbox"})," test-unit"))),(0,o.kt)("strong",null,"Do you use VCR, WebMock, or FakeWeb gem?"),(0,o.kt)("ul",{className:"none-list"},(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(s,{id:"vcr-webmock-fakeweb",mdxType:"TestRunnerCheckbox"})," Yes"))),(0,o.kt)("strong",null,"What is your CI provider?"),(0,o.kt)("ul",{className:"none-list"},(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(i,{value:"appveyor",mdxType:"CiRadio"})," AppVeyor")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(i,{value:"buildkite",mdxType:"CiRadio"})," Buildkite")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(i,{value:"circleci",mdxType:"CiRadio"})," CircleCI")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(i,{value:"cirrus-ci",mdxType:"CiRadio"})," Cirrus CI")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(i,{value:"codeship",mdxType:"CiRadio"})," CloudBees CodeShip")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(i,{value:"codefresh",mdxType:"CiRadio"})," Codefresh")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(i,{value:"github-actions",mdxType:"CiRadio"})," GitHub Actions")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(i,{value:"gitlab-ci",mdxType:"CiRadio"})," GitLab CI")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(i,{value:"heroku-ci",mdxType:"CiRadio"})," Heroku CI")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(i,{value:"jenkins",mdxType:"CiRadio"})," Jenkins")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(i,{value:"semaphoreci",mdxType:"CiRadio"})," Semaphore CI")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(i,{value:"travis-ci",mdxType:"CiRadio"})," Travis CI")),(0,o.kt)("li",null,(0,o.kt)("label",null,(0,o.kt)(i,{value:"other",mdxType:"CiRadio"})," Other"))),(0,o.kt)("div",{id:"guide-test-runner-rspec",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-rspec"},"Step for RSpec"),(0,o.kt)("p",null,"  Add the following code at the beginning of your ",(0,o.kt)("inlineCode",{parentName:"p"},"spec/rails_helper.rb")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"spec/spec_helper.rb"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ruby"},"require 'knapsack_pro'\nKnapsackPro::Adapters::RSpecAdapter.bind\n"))),(0,o.kt)("div",{id:"guide-test-runner-minitest",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-minitest"},"Step for Minitest"),(0,o.kt)("p",null,"  Add the Knapsack Pro code after you load the app environment in the ",(0,o.kt)("inlineCode",{parentName:"p"},"test/test_helper.rb")," file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ruby"},"ENV['RAILS_ENV'] ||= 'test'\nrequire File.expand_path('../../config/environment', __FILE__)\nrequire 'rails/test_help'\n\nrequire 'knapsack_pro'\nknapsack_pro_adapter = KnapsackPro::Adapters::MinitestAdapter.bind\nknapsack_pro_adapter.set_test_helper_path(__FILE__)\n"))),(0,o.kt)("div",{id:"guide-test-runner-test-unit",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-test-unit"},"Step for test-unit"),(0,o.kt)("p",null,"  Add the following code at the beginning of your ",(0,o.kt)("inlineCode",{parentName:"p"},"test/test_helper.rb"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ruby"},"require 'knapsack_pro'\nknapsack_pro_adapter = KnapsackPro::Adapters::TestUnitAdapter.bind\nknapsack_pro_adapter.set_test_helper_path(__FILE__)\n"))),(0,o.kt)("div",{id:"guide-test-runner-cucumber",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-cucumber"},"Step for Cucumber"),(0,o.kt)("p",null,"  Create a ",(0,o.kt)("inlineCode",{parentName:"p"},"features/support/knapsack_pro.rb")," file with the following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ruby"},"require 'knapsack_pro'\nKnapsackPro::Adapters::CucumberAdapter.bind\n"))),(0,o.kt)("div",{id:"guide-test-runner-spinach",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-spinach"},"Step for Spinach"),(0,o.kt)("p",null,"  Create a ",(0,o.kt)("inlineCode",{parentName:"p"},"features/support/knapsack_pro.rb")," file with the following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ruby"},"require 'knapsack_pro'\nKnapsackPro::Adapters::SpinachAdapter.bind\n"))),(0,o.kt)("div",{id:"guide-vcr-webmock-fakeweb",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-vcrwebmockfakeweb-gems"},"Step for VCR/WebMock/FakeWeb gems"),(0,o.kt)("p",null,"  Add Knapsack Pro API subdomain to ignored hosts in ",(0,o.kt)("inlineCode",{parentName:"p"},"spec/spec_helper.rb")," (or wherever your VCR configuration is located):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ruby"},"require 'vcr'\nVCR.configure do |config|\n  config.hook_into :webmock # or :fakeweb\n  config.ignore_hosts('localhost', '127.0.0.1', '0.0.0.0', 'api.knapsackpro.com')\nend\n\n# add the following code if you use webmock:\nrequire 'webmock/rspec'\nWebMock.disable_net_connect!(allow_localhost: true, allow: ['api.knapsackpro.com'])\n\n# add the following code if you use FakeWeb:\nrequire 'fakeweb'\nFakeWeb.allow_net_connect = %r[^https?://api\\.knapsackpro\\.com]\n")),(0,o.kt)("p",null,"  Ensure you have the ",(0,o.kt)("inlineCode",{parentName:"p"},"require: false")," setting in Gemfile for the webmock gem when VCR is hooked into it. Thanks to that, the webmock configuration from ",(0,o.kt)("inlineCode",{parentName:"p"},"spec_helper.rb")," is loaded properly."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ruby"},"group :test do\n  gem 'vcr'\n  gem 'webmock', require: false\n  gem 'fakeweb', require: false # example when you use fakeweb\nend\n")),(0,o.kt)("p",null,"  If you still happen to see your tests failing due to WebMock not allowing requests to Knapsack Pro API, it probably means that you reconfigure WebMock in some of your tests.\nFor instance, you might be using ",(0,o.kt)("inlineCode",{parentName:"p"},"WebMock.reset!"),". It might also be called automatically in an ",(0,o.kt)("inlineCode",{parentName:"p"},"after(:each)")," block when using ",(0,o.kt)("inlineCode",{parentName:"p"},"require 'webmock/rspec'")," (",(0,o.kt)("a",{href:"https://github.com/bblimke/webmock/issues/484#issuecomment-116193449",target:"_blank"},"more about the issue"),"). This would remove ",(0,o.kt)("inlineCode",{parentName:"p"},"api.knapsackpro.com")," from the allowed domains. In this case, please try the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ruby"},"RSpec.configure do |config|\n  config.after(:suite) do\n    WebMock.disable_net_connect!(\n      allow_localhost: true,\n      allow: [\n        'api.knapsackpro.com',\n      ],\n    )\n  end\nend\n"))),(0,o.kt)("div",{id:"guide-providers"},(0,o.kt)("div",{id:"guide-provider-circleci",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-circleci"},"Step for CircleCI"),(0,o.kt)("p",null,"Example config file for the CircleCI 2.0 platform."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"# CircleCI 2.0\n# .circleci/config.yml\nversion: 2\njobs:\nbuild:\n  parallelism: 2\n  steps:\n    - checkout\n\n    # ... other configs\n\n    # some tests that are not balanced and executed only on the first CI node\n    - run: case $CIRCLE_NODE_INDEX in 0) npm test ;; esac\n\n    # auto-balancing CI build execution time (making the whole build as fast as possible).\n    # Queue Mode does dynamic tests allocation, so the previous unbalanced run command won't\n    # create a bottleneck on the CI node\n    - run:\n      name: RSpec via knapsack_pro Queue Mode\n      command: |\n        # please don't forget the `export` keyword!\n        export RAILS_ENV=test\n        bundle exec rake \"knapsack_pro:queue:rspec[--format documentation]\"\n\n    - run:\n      name: Minitest via knapsack_pro Queue Mode\n      command: |\n        # please don't forget the `export` keyword!\n        export RAILS_ENV=test\n        bundle exec rake \"knapsack_pro:queue:minitest[--verbose]\"\n\n    - run:\n      name: Cucumber via knapsack_pro Queue Mode\n      command: |\n        # please don't forget the `export` keyword!\n        export RAILS_ENV=test\n        # If you use spring gem and spring-commands-cucumber gem to start Cucumber tests faster, please set\n        # export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bundle exec spring\n        # or alternatively you can use spring binstub:\n        # export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bin/spring\n        # Thanks to that, Cucumber will start tests faster for each batch of tests fetched from the Knapsack Pro Queue API\n        bundle exec rake knapsack_pro:queue:cucumber\n")),(0,o.kt)("p",null,"  Adjust the number of parallel containers with the ",(0,o.kt)("inlineCode",{parentName:"p"},"parallelism")," attribute."),(0,o.kt)("p",null,"  Please consult a full example of ",(0,o.kt)("a",{href:"https://docs.knapsackpro.com//2017/circleci-2-0-capybara-feature-specs-selenium-webdriver-with-chrome-headless",target:"_blank"},"Rails project config on CircleCI 2.0")," for more details."),(0,o.kt)("p",null,"If you use knapsack_pro Queue Mode with CircleCI, you may want to collect metadata like ",(0,o.kt)("a",{href:"https://github.com/KnapsackPro/knapsack_pro-ruby#circleci-and-knapsack_pro-queue-mode",target:"_blank"},"junit xml report about your RSpec")," test suite with junit formatter. Thanks to that, you can see failed tests in the nice CircleCI web UI. It's also possible to ",(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/how-to-use-junit-formatter",target:"_blank"},"configure junit formatter for knapsack_pro Regular Mode"),"."),(0,o.kt)("p",null,"Please remember to add additional containers for your project in CircleCI settings.")),(0,o.kt)("div",{id:"guide-provider-travis-ci",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-travis-ci"},"Step for Travis CI"),(0,o.kt)("p",null,"You can parallelize your builds across virtual machines with the ",(0,o.kt)("a",{parentName:"p",href:"http://docs.travis-ci.com/user/speeding-up-the-build/#parallelizing-your-builds-across-virtual-machines"},"travis matrix feature"),". Edit your config in the ",(0,o.kt)("inlineCode",{parentName:"p"},".travis.yml")," file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'script:\n# Step for RSpec in Regular Mode\n- "bundle exec rake knapsack_pro:rspec"\n\n# Step for RSpec in Queue Mode\n- "bundle exec rake knapsack_pro:queue:rspec"\n\n# Step for Cucumber in Regular Mode\n- "bundle exec rake knapsack_pro:cucumber"\n\n# Step for Cucumber in Queue Mode\n- "bundle exec rake knapsack_pro:queue:cucumber"\n\n# Step for Minitest in Regular Mode\n- "bundle exec rake knapsack_pro:minitest"\n\n# Step for Minitest in Queue Mode\n- "bundle exec rake knapsack_pro:queue:minitest"\n\n# Step for test-unit in Regular Mode\n- "bundle exec rake knapsack_pro:test_unit"\n\n# Step for Spinach in Regular Mode\n- "bundle exec rake knapsack_pro:spinach"\n\nenv:\nglobal:\n  # tokens should be set in the Travis settings web interface to avoid exposing tokens in the build logs\n  - KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC=rspec-token\n  - KNAPSACK_PRO_TEST_SUITE_TOKEN_CUCUMBER=cucumber-token\n  - KNAPSACK_PRO_TEST_SUITE_TOKEN_MINITEST=minitest-token\n  - KNAPSACK_PRO_TEST_SUITE_TOKEN_TEST_UNIT=test-unit-token\n  - KNAPSACK_PRO_TEST_SUITE_TOKEN_SPINACH=spinach-token\n\n  # if you use Knapsack Pro Queue Mode, you should set the following env variable to ensure\n  # the correct set of tests is being run when retrying a single failed parallel job from the Travis UI\n  - KNAPSACK_PRO_FIXED_QUEUE_SPLIT=true\n\n  - KNAPSACK_PRO_CI_NODE_TOTAL=2\njobs:\n  - KNAPSACK_PRO_CI_NODE_INDEX=0\n  - KNAPSACK_PRO_CI_NODE_INDEX=1\n')),(0,o.kt)("p",null,"This configuration will generate a matrix with the following 2 env rows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"KNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC=rspec-token KNAPSACK_PRO_TEST_SUITE_TOKEN_CUCUMBER=cucumber-token KNAPSACK_PRO_TEST_SUITE_TOKEN_MINITEST=minitest-token KNAPSACK_PRO_TEST_SUITE_TOKEN_TEST_UNIT=test-unit-token KNAPSACK_PRO_TEST_SUITE_TOKEN_SPINACH=spinach-token\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC=rspec-token KNAPSACK_PRO_TEST_SUITE_TOKEN_CUCUMBER=cucumber-token KNAPSACK_PRO_TEST_SUITE_TOKEN_MINITEST=minitest-token KNAPSACK_PRO_TEST_SUITE_TOKEN_TEST_UNIT=test-unit-token KNAPSACK_PRO_TEST_SUITE_TOKEN_SPINACH=spinach-token\n")),(0,o.kt)("p",null,"You can find more info about global and matrix env configuration in ",(0,o.kt)("a",{href:"https://docs.travis-ci.com/user/customizing-the-build/#build-matrix",target:"_blank"},"travis docs"),".")),(0,o.kt)("div",{id:"guide-provider-buildkite",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-buildkite"},"Step for Buildkite"),(0,o.kt)("p",null,"  Knapsack Pro automatically reads the Buildkite ENV variables: ",(0,o.kt)("inlineCode",{parentName:"p"},"BUILDKITE_PARALLEL_JOB_COUNT")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"BUILDKITE_PARALLEL_JOB"),". The only thing you need to do is to configure the ",(0,o.kt)("inlineCode",{parentName:"p"},"parallelism")," parameter in your build step and run the appropriate command in your build:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Step for RSpec\nbundle exec rake knapsack_pro:rspec\n\n# Step for Cucumber\nbundle exec rake knapsack_pro:cucumber\n\n# Step for Minitest\nbundle exec rake knapsack_pro:minitest\n\n# Step for test-unit\nbundle exec rake knapsack_pro:test_unit\n\n# Step for Spinach\nbundle exec rake knapsack_pro:spinach\n")),(0,o.kt)("p",null,"  Please remember to set up your ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC")," as a global environment variable."),(0,o.kt)("p",null,"Here you can find an article showing ",(0,o.kt)("a",{href:"http://docs.knapsackpro.com/2017/auto-balancing-7-hours-tests-between-100-parallel-jobs-on-ci-buildkite-example",target:"_blank"},"how to set up a new pipeline for your project in Buildkite and configure Knapsack Pro"),". You can also check out the following example repositories for Ruby/Rails projects:"),(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://github.com/KnapsackPro/buildkite-rails-parallel-example-with-knapsack_pro",target:"_blank"},"Buildkite Rails Parallel Example with Knapsack Pro")),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://github.com/KnapsackPro/buildkite-rails-docker-parallel-example-with-knapsack_pro",target:"_blank"},"Buildkite Rails Docker Parallel Example with Knapsack Pro"))),(0,o.kt)("p",null,"  If you want to retry single Buildkite agents (CI nodes), then you should set ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/KnapsackPro/knapsack_pro-ruby#knapsack_pro_fixed_queue_split-remember-queue-split-on-retry-ci-node"},(0,o.kt)("inlineCode",{parentName:"a"},"KNAPSACK_PRO_FIXED_QUEUE_SPLIT=true")),"."),(0,o.kt)("p",null,"  When using the ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose")," plugin on Buildkite, you have to pass some environment variables to the docker container. This is needed for Knapsack Pro to work correctly:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'steps:\n- label: "Test"\n  parallelism: 2\n  plugins:\n    - docker-compose#3.0.3:\n      run: app\n      # use the proper knapsack_pro command for your test runner here\n      command: bundle exec rake knapsack_pro:queue:rspec\n      config: docker-compose.test.yml\n      env:\n        - BUILDKITE_PARALLEL_JOB_COUNT\n        - BUILDKITE_PARALLEL_JOB\n        - BUILDKITE_BUILD_NUMBER\n        - BUILDKITE_COMMIT\n        - BUILDKITE_BRANCH\n        - BUILDKITE_BUILD_CHECKOUT_PATH\n'))),(0,o.kt)("div",{id:"guide-provider-semaphoreci",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-semaphore-ci"},"Step for Semaphore CI"),(0,o.kt)("h4",{id:"semaphore-20-click-here-for-semaphore-10"},"Semaphore 2.0 ",(0,o.kt)("small",null,"(",(0,o.kt)("a",{href:"#semaphore_1_0"},"click here for Semaphore 1.0"),")")),(0,o.kt)("p",null,"Knapsack Pro supports environment variables provided by Semaphore CI 2.0 to run your tests. You need to define a few things in the ",(0,o.kt)("inlineCode",{parentName:"p"},".semaphore/semaphore.yml")," config file."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"You need to set ",(0,o.kt)("inlineCode",{parentName:"li"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC"),". If you don't want to commit secrets in the yml file, you can ",(0,o.kt)("a",{parentName:"li",href:"https://docs.semaphoreci.com/article/66-environment-variables-and-secrets"},"follow this guide"),"."),(0,o.kt)("li",{parentName:"ul"},"You should create as many parallel jobs as you need with the ",(0,o.kt)("em",{parentName:"li"},"parallelism")," property. Use more parallel jobs for long test suites.")),(0,o.kt)("p",null,"Full Semaphore CI 2.0 config example for a Rails project:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"# .semaphore/semaphore.yml\n# Use the latest stable version of Semaphore 2.0 YML syntax:\nversion: v1.0\n\nname: Demo Rails 5 app\n\nagent:\nmachine:\n  type: e1-standard-2\n  os_image: ubuntu1804\n\nblocks:\n- name: Setup\n  task:\n    env_vars:\n      - name: RAILS_ENV\n        value: test\n    jobs:\n      - name: bundle\n        commands:\n        - checkout\n        - cache restore gems-$SEMAPHORE_GIT_BRANCH-$(checksum Gemfile.lock),gems-$SEMAPHORE_GIT_BRANCH-,gems-master-\n        - sem-version ruby 2.6.1\n        - bundle install --jobs=4 --retry=3 --path vendor/bundle\n        - cache store gems-$SEMAPHORE_GIT_BRANCH-$(checksum Gemfile.lock) vendor/bundle\n\n- name: RSpec tests\n  task:\n    env_vars:\n      - name: RAILS_ENV\n        value: test\n      - name: PGHOST\n        value: 127.0.0.1\n      - name: PGUSER\n        value: postgres\n      - name: KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC\n        value: your_api_token_here\n    prologue:\n      commands:\n        - checkout\n        - cache restore gems-$SEMAPHORE_GIT_BRANCH-$(checksum Gemfile.lock),gems-$SEMAPHORE_GIT_BRANCH-,gems-master-\n        - sem-service start postgres\n        - sem-version ruby 2.6.1\n        - bundle install --jobs=4 --retry=3 --path vendor/bundle\n        - bundle exec rake db:setup\n\n    jobs:\n    - name: Run tests with Knapsack Pro\n      parallelism: 2\n      commands:\n      # Step for RSpec in Queue Mode\n      - bundle exec rake knapsack_pro:queue:rspec\n      # Step for Cucumber in Queue Mode\n      # If you use spring gem and spring-commands-cucumber gem to start Cucumber tests faster, please set:\n      # export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bundle exec spring\n      # or alternatively you can use spring binstub:\n      # export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bin/spring\n      # Thanks to that, Cucumber will start tests faster for each batch of tests fetched from the Knapsack Pro Queue API\n      - bundle exec rake knapsack_pro:queue:cucumber\n\n      # Step for RSpec in Regular Mode\n      - bundle exec rake knapsack_pro:rspec\n      # Step for Cucumber in Regular Mode\n      - bundle exec rake knapsack_pro:cucumber\n      # Step for Minitest in Regular Mode\n      - bundle exec rake knapsack_pro:minitest\n      # Step for test-unit in Regular Mode\n      - bundle exec rake knapsack_pro:test_unit\n      # Step for Spinach in Regular Mode\n      - bundle exec rake knapsack_pro:spinach\n")),(0,o.kt)("h4",{id:"semaphore_1_0"},"Semaphore 1.0"),(0,o.kt)("p",null,"  Run the proper ",(0,o.kt)("inlineCode",{parentName:"p"},"knapsack_pro")," command for as many threads as you need. Here is an example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Thread 1\n## Step for RSpec\nbundle exec rake knapsack_pro:rspec\n## Step for Cucumber\nbundle exec rake knapsack_pro:cucumber\n## Step for Minitest\nbundle exec rake knapsack_pro:minitest\n## Step for test-unit\nbundle exec rake knapsack_pro:test_unit\n## Step for Spinach\nbundle exec rake knapsack_pro:spinach\n\n# Thread 2\n## Step for RSpec\nbundle exec rake knapsack_pro:rspec\n## Step for Cucumber\nbundle exec rake knapsack_pro:cucumber\n## Step for Minitest\nbundle exec rake knapsack_pro:minitest\n## Step for test-unit\nbundle exec rake knapsack_pro:test_unit\n## Step for Spinach\nbundle exec rake knapsack_pro:spinach\n")),(0,o.kt)("p",null,"Your tests will be divided across threads."),(0,o.kt)("p",null,"  Please remember to set up the ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC")," token as a global environment variable.")),(0,o.kt)("div",{id:"guide-provider-codeship",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-cloudbees-codeship"},"Step for CloudBees CodeShip"),(0,o.kt)("p",null,"  You need to define a ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_CI_NODE_TOTAL")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_CI_NODE_INDEX")," environment variables for each ",(0,o.kt)("a",{href:"https://documentation.codeship.com/basic/builds-and-configuration/parallel-tests/#using-parallel-test-pipelines",target:"_blank"},"parallel test pipeline"),". Here is an example for 2 pipelines."),(0,o.kt)("p",null,"First pipeline:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# first CI node running in parallel\n\n# Cucumber tests in Knapsack Pro Regular Mode\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:cucumber\n\n# Cucumber tests in Knapsack Pro Queue Mode\n# If you use spring gem and spring-commands-cucumber gem to start Cucumber tests faster, please set:\n# export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bundle exec spring\n# or alternatively you can use spring binstub:\n# export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bin/spring\n# Thanks to that, Cucumber will start tests faster for each batch of tests fetched from the Knapsack Pro Queue API\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:queue:cucumber\n\n# RSpec tests in Knapsack Pro Queue Mode\n# It will help balance your build because it is executed after Cucumber tests.\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:queue:rspec\n")),(0,o.kt)("p",null,"Second pipeline:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# second CI node running in parallel\n\n# Cucumber tests in Knapsack Pro Regular Mode\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:cucumber\n\n# Cucumber tests in Knapsack Pro Queue Mode\n# If you use spring gem and spring-commands-cucumber gem to start Cucumber tests faster, please set:\n# export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bundle exec spring\n# or alternatively you can use spring binstub:\n# export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bin/spring\n# Thanks to that, Cucumber will start tests faster for each batch of tests fetched from the Knapsack Pro Queue API\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:queue:cucumber\n\n# RSpec tests in Knapsack Pro Queue Mode\n# It will help balance your build because it is executed after Cucumber tests.\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:queue:rspec\n")),(0,o.kt)("p",null,"  Remember to define API tokens as ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_CUCUMBER")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC")," on the ",(0,o.kt)("i",null,"Environment")," page of your project settings in CodeShip."),(0,o.kt)("p",null,"  CodeShip uses the same build number if you restart a build. Because of that, you need to set ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/KnapsackPro/knapsack_pro-ruby#knapsack_pro_fixed_queue_split-remember-queue-split-on-retry-ci-node"},(0,o.kt)("inlineCode",{parentName:"a"},"KNAPSACK_PRO_FIXED_QUEUE_SPLIT=true"))," in order to be able to restart a CI build in Queue Mode.")),(0,o.kt)("div",{id:"guide-provider-heroku-ci",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-heroku-ci"},"Step for Heroku CI"),(0,o.kt)("p",null,"  You can parallelize your tests on Heroku CI using the ",(0,o.kt)("inlineCode",{parentName:"p"},"app.json")," file."),(0,o.kt)("p",null,"  You can set the number of parallel dynos you want to run with the ",(0,o.kt)("inlineCode",{parentName:"p"},"quantity")," value.\nUse the ",(0,o.kt)("inlineCode",{parentName:"p"},"test")," key to run Knapsack Pro."),(0,o.kt)("p",null,"  You also need to specify the environment variable with an API token for Knapsack Pro.\nThis should not be stored directly in the ",(0,o.kt)("inlineCode",{parentName:"p"},"app.json"),", so you can add them to your pipeline's Heroku CI settings (we show it below in the config for illustrative purposes)."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'# app.json\n{\n"environments": {\n  "test": {\n    "formation": {\n      "test": {\n        "quantity": 2\n      }\n    },\n    "addons": [\n      "heroku-postgresql"\n    ],\n    "scripts": {\n      "test": "bundle exec rake knapsack_pro:rspec"\n    },\n    "env": {\n      # just an example - this should be defined outside the json config file\n      "KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC": "rspec-token"\n    }\n  }\n}\n}\n')),(0,o.kt)("p",null,"Please see this article if you would like to ",(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/how-to-run-multiple-test-suite-commands-in-heroku-ci",target:"_blank"},"run multiple Knapsack Pro commands for different test runners on Heroku CI"),"."),(0,o.kt)("p",null,"You can learn more about ",(0,o.kt)("a",{href:"https://devcenter.heroku.com/articles/heroku-ci",target:"_blank"},"Heroku CI"),".")),(0,o.kt)("div",{id:"guide-provider-appveyor",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-appveyor"},"Step for AppVeyor"),(0,o.kt)("p",null,"  You need to define ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_CI_NODE_TOTAL")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_CI_NODE_INDEX")," variables for each parallel job running as part of the same CI build."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Step for RSpec for the first CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:rspec\n# Step for RSpec for the second CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:rspec\n\n# Step for Cucumber for the first CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:cucumber\n# Step for Cucumber for the second CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:cucumber\n\n# Step for Minitest for the first CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:minitest\n# Step for Minitest for the second CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:minitest\n\n# Step for test-unit for the first CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:test_unit\n# Step for test-unit for the second CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:test_unit\n\n# Step for Spinach for the first CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:spinach\n# Step for Spinach for the second CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:spinach\n")),(0,o.kt)("p",null,"  Please remember to define your API token in the ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC")," global environment variable.")),(0,o.kt)("div",{id:"guide-provider-gitlab-ci",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-gitlab-ci"},"Step for GitLab CI"),(0,o.kt)("p",null,"  Remember to add your API tokens as env variables (e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_CUCUMBER")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC"),") to ",(0,o.kt)("a",{href:"https://gitlab.com/help/ci/variables/README.md#secret-variables",target:"_blank"},"Secret Variables")," in GitLab CI Settings -> CI/CD Pipelines -> Secret Variables."),(0,o.kt)("h4",null,"GitLab CI >= 11.5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"test:\nparallel: 2\n\n# Knapsack Pro Regular Mode\nscript: bundle exec rake knapsack_pro:rspec\n\n# Other commands:\n\n# Knapsack Pro Regular Mode\n# bundle exec rake knapsack_pro:cucumber\n# bundle exec rake knapsack_pro:minitest\n# bundle exec rake knapsack_pro:test_unit\n# bundle exec rake knapsack_pro:spinach\n\n# Knapsack Pro Queue Mode\n# bundle exec rake knapsack_pro:queue:rspec\n# bundle exec rake knapsack_pro:queue:minitest\n\n# If you use spring gem and spring-commands-cucumber gem to start Cucumber tests faster, please set:\n# export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bundle exec spring\n# or alternatively you can use spring binstub:\n# export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bin/spring\n# Thanks to that, Cucumber will start tests faster for each batch of tests fetched from the Knapsack Pro Queue API\n# bundle exec rake knapsack_pro:queue:cucumber\n")),(0,o.kt)("p",null,"Find out ",(0,o.kt)("a",{href:"https://docs.gitlab.com/ee/ci/yaml/#parallel",target:"_blank"},"how to configure running parallel CI nodes in GitLab"),"."),(0,o.kt)("h4",null,"GitLab CI < 11.5 (old GitLab CI)"),(0,o.kt)("p",null,"  You need to define ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_CI_NODE_TOTAL")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_CI_NODE_INDEX")," environment variables for each parallel job running as part of the same test stage. Here is a relevant part of the ",(0,o.kt)("inlineCode",{parentName:"p"},".gitlab-ci.yml")," configuration file for 2 parallel jobs:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"# .gitlab-ci.yml\nstages:\n- test\n\nvariables:\nKNAPSACK_PRO_CI_NODE_TOTAL: 2\n\n# first CI node\ntest_ci_node_0:\nstage: test\nscript:\n  - export KNAPSACK_PRO_CI_NODE_INDEX=0\n  # Cucumber tests in Knapsack Pro Regular Mode\n  - bundle exec rake knapsack_pro:cucumber\n\n  # Cucumber tests in Knapsack Pro Queue Mode\n  # If you use spring gem and spring-commands-cucumber gem to start Cucumber tests faster, please set:\n  # export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bundle exec spring\n  # or alternatively you can use spring binstub:\n  # export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bin/spring\n  # Thanks to that, Cucumber will start tests faster for each batch of tests fetched from the Knapsack Pro Queue API\n  - bundle exec rake knapsack_pro:queue:cucumber\n\n  # RSpec tests in Knapsack Pro Queue Mode\n  # It will help balance your build because it is executed after Cucumber tests.\n  - bundle exec rake knapsack_pro:queue:rspec\n\n# second CI node\ntest_ci_node_1:\nstage: test\nscript:\n  - export KNAPSACK_PRO_CI_NODE_INDEX=1\n  - bundle exec rake knapsack_pro:cucumber\n\n  # If you use spring gem and spring-commands-cucumber gem to start Cucumber tests faster, please set:\n  # export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bundle exec spring\n  # or alternatively you can use spring binstub:\n  # export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bin/spring\n  # Thanks to that, Cucumber will start tests faster for each batch of tests fetched from the Knapsack Pro Queue API\n  - bundle exec rake knapsack_pro:queue:cucumber\n\n  - bundle exec rake knapsack_pro:queue:rspec\n"))),(0,o.kt)("div",{id:"guide-provider-cirrus-ci",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-cirrus-ci"},"Step for Cirrus CI"),(0,o.kt)("p",null,"You need to configure running your desired number of parallel CI nodes in Cirrus. Then, make sure you run one of the following commands on each parallel CI node:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Step for RSpec\nbundle exec rake knapsack_pro:rspec\n\n# Step for Cucumber\nbundle exec rake knapsack_pro:cucumber\n\n# Step for Minitest\nbundle exec rake knapsack_pro:minitest\n\n# Step for test-unit\nbundle exec rake knapsack_pro:test_unit\n\n# Step for Spinach\nbundle exec rake knapsack_pro:spinach\n")),(0,o.kt)("p",null,"  Please remember to define your API token in a global environment variable (e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC")," for RSpec)."),(0,o.kt)("p",null,"  Here is an example of a ",(0,o.kt)("a",{parentName:"p",href:"https://cirrus-ci.org/examples/#ruby"},(0,o.kt)("inlineCode",{parentName:"a"},".cirrus.yml")," configuration file"),".")),(0,o.kt)("div",{id:"guide-provider-jenkins",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-jenkins"},"Step for Jenkins"),(0,o.kt)("p",null,"In order to run parallel jobs with Jenkins you should use Jenkins Pipeline.",(0,o.kt)("br",null),"You can learn more in this article: ",(0,o.kt)("a",{href:"https://www.cloudbees.com/blog/parallelism-and-distributed-builds-jenkins",target:"_blank"},"Parallelism and Distributed Builds with Jenkins"),"."),(0,o.kt)("p",null,"  Here is an example of a ",(0,o.kt)("inlineCode",{parentName:"p"},"Jenkinsfile")," working with Jenkins Pipeline."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-groovy"},'timeout(time: 60, unit: \'MINUTES\') {\nnode() {\n  stage(\'Checkout\') {\n    checkout([/* checkout code from git */])\n\n    // determine git commit hash because we need to pass it to knapsack_pro\n    COMMIT_HASH = sh(returnStdout: true, script: \'git rev-parse HEAD\').trim()\n\n    stash \'source\'\n  }\n}\n\ndef num_nodes = 4; // define your total number of CI nodes (how many parallel jobs will be executed)\ndef nodes = [:]\n\nfor (int i = 0; i < num_nodes; i++) {\n  def index = i;\n  nodes["ci_node_${i}"] = {\n    node() {\n      stage(\'Setup\') {\n        unstash \'source\'\n        // other setup steps\n      }\n\n      def knapsack_options = """\\\n          KNAPSACK_PRO_CI_NODE_TOTAL=${num_nodes}\\\n          KNAPSACK_PRO_CI_NODE_INDEX=${index}\\\n          KNAPSACK_PRO_COMMIT_HASH=${COMMIT_HASH}\\\n          KNAPSACK_PRO_BRANCH=${env.BRANCH_NAME}\\\n      """\n\n      // example: running cucumber tests in Knapsack Pro Regular Mode\n      stage(\'Run cucumber\') {\n        sh """${knapsack_options} bundle exec rake knapsack_pro:cucumber"""\n      }\n\n      // example: running RSpec tests in Knapsack Pro Queue Mode\n      // Queue Mode should be run as a last stage so it can help balance the build if tests in the Regular Mode were not perfectly distributed\n      stage(\'Run rspec\') {\n        sh """KNAPSACK_PRO_CI_NODE_BUILD_ID=${env.BUILD_TAG} ${knapsack_options} bundle exec rake knapsack_pro:queue:rspec"""\n      }\n    }\n  }\n}\n\nparallel nodes // run CI nodes in parallel\n}\n')),(0,o.kt)("p",null,"  Please remember to define your API token in a global environment variable (e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC")," for RSpec)."),(0,o.kt)("p",null,"In the above example, we first run cucumber tests in the Regular Mode and then RSpec tests in the Queue Mode. Queue Mode assigns tests dynamically, so running it at the end helps balance the workload between the nodes.")),(0,o.kt)("div",{id:"guide-provider-github-actions",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-github-actions"},"Step for GitHub Actions"),(0,o.kt)("p",null,"  You need to define a few things in your ",(0,o.kt)("inlineCode",{parentName:"p"},".github/workflows/main.yaml")," config file."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Set up your API token (e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC"),") in GitHub settings -> Secrets for your repository. (",(0,o.kt)("a",{parentName:"li",href:"https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository"},"More info"),")."),(0,o.kt)("li",{parentName:"ul"},"You should create as many parallel jobs as you need with the ",(0,o.kt)("a",{parentName:"li",href:"https://help.github.com/en/articles/workflow-syntax-for-github-actions#jobsjob_idstrategymatrix"},(0,o.kt)("inlineCode",{parentName:"a"},"matrix")," property"),". Use more parallel jobs for slow test suites.")),(0,o.kt)("p",null,"Here is a full GitHub Actions config for a Ruby on Rails project:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'{% raw %}\n# .github/workflows/main.yaml\nname: Main\n\non: [push]\n\njobs:\ntest:\n  runs-on: ubuntu-latest\n\n  # If you need a DB, then define it in the service below.\n  # https://github.com/actions/example-services/tree/master/.github/workflows\n  services:\n    postgres:\n      image: postgres:10.8\n      env:\n        POSTGRES_USER: postgres\n        POSTGRES_PASSWORD: ""\n        POSTGRES_DB: postgres\n      ports:\n        - 5432:5432\n      # needed because the postgres container does not provide a healthcheck\n      # tmpfs makes DB faster by using RAM\n      options: >-\n        --mount type=tmpfs,destination=/var/lib/postgresql/data\n        --health-cmd pg_isready\n        --health-interval 10s\n        --health-timeout 5s\n        --health-retries 5\n    redis:\n      image: redis\n      ports:\n        - 6379:6379\n      options: --entrypoint redis-server\n\n  # https://help.github.com/en/articles/workflow-syntax-for-github-actions#jobsjob_idstrategymatrix\n  strategy:\n    fail-fast: false\n    matrix:\n      # [n] - where the n is a number of parallel jobs you want to run your tests on.\n      # Use a higher number if you have slow tests to split them between more parallel jobs.\n      # Remember to update the value of the `ci_node_index` below to (0..n-1).\n      ci_node_total: [2]\n      # Indexes for parallel jobs (starting from zero).\n      # E.g. use [0, 1] for 2 parallel jobs, [0, 1, 2] for 3 parallel jobs, etc.\n      ci_node_index: [0, 1]\n\n  env:\n    RAILS_ENV: test\n    GEMFILE_RUBY_VERSION: 2.7.2\n    PGHOST: localhost\n    PGUSER: postgres\n    # Rails verifies the time zone in DB is the same as the time zone of the Rails app\n    TZ: "Europe/Warsaw"\n\n  steps:\n    - uses: actions/checkout@v2\n\n    - name: Set up Ruby\n      uses: ruby/setup-ruby@v1\n      with:\n        # Not needed with a .ruby-version file\n        ruby-version: 2.7\n        # runs \'bundle install\' and caches installed gems automatically\n        bundler-cache: true\n\n    - name: Create DB\n      run: |\n        bin/rails db:prepare\n    - name: Run tests\n      env:\n        KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC: ${{ secrets.KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC }}\n        KNAPSACK_PRO_TEST_SUITE_TOKEN_CUCUMBER: ${{ secrets.KNAPSACK_PRO_TEST_SUITE_TOKEN_CUCUMBER }}\n        KNAPSACK_PRO_TEST_SUITE_TOKEN_MINITEST: ${{ secrets.KNAPSACK_PRO_TEST_SUITE_TOKEN_MINITEST }}\n        KNAPSACK_PRO_TEST_SUITE_TEST_UNIT: ${{ secrets.KNAPSACK_PRO_TEST_SUITE_TOKEN_TEST_UNIT }}\n        KNAPSACK_PRO_TEST_SUITE_TOKEN_SPINACH: ${{ secrets.KNAPSACK_PRO_TEST_SUITE_TOKEN_SPINACH }}\n        KNAPSACK_PRO_CI_NODE_TOTAL: ${{ matrix.ci_node_total }}\n        KNAPSACK_PRO_CI_NODE_INDEX: ${{ matrix.ci_node_index }}\n        KNAPSACK_PRO_LOG_LEVEL: info\n        # if you use Knapsack Pro Queue Mode you must set below env variable\n        # to be able to retry CI build and run previously recorded tests\n        # https://github.com/KnapsackPro/knapsack_pro-ruby#knapsack_pro_fixed_queue_split-remember-queue-split-on-retry-ci-node\n        KNAPSACK_PRO_FIXED_QUEUE_SPLIT: true\n        # RSpec split test files by test examples feature - it\'s optional\n        # https://knapsackpro.com/faq/question/how-to-split-slow-rspec-test-files-by-test-examples-by-individual-it\n        # KNAPSACK_PRO_RSPEC_SPLIT_BY_TEST_EXAMPLES: true\n      run: |\n        # run tests in Knapsack Pro Regular Mode\n        bundle exec rake knapsack_pro:rspec\n        bundle exec rake knapsack_pro:cucumber\n        bundle exec rake knapsack_pro:minitest\n        bundle exec rake knapsack_pro:test_unit\n        bundle exec rake knapsack_pro:spinach\n        # you can use Knapsack Pro in Queue Mode once recorded first CI build with Regular Mode\n        bundle exec rake knapsack_pro:queue:rspec\n        bundle exec rake knapsack_pro:queue:cucumber\n        bundle exec rake knapsack_pro:queue:minitest\n{% endraw %}\n')),(0,o.kt)("p",null,"  Github Actions uses the same build number if you restart a build. Because of that, you need to set ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/KnapsackPro/knapsack_pro-ruby#knapsack_pro_fixed_queue_split-remember-queue-split-on-retry-ci-node"},(0,o.kt)("inlineCode",{parentName:"a"},"KNAPSACK_PRO_FIXED_QUEUE_SPLIT=true"))," in order to be able to restart a CI build in Queue Mode.")),(0,o.kt)("div",{id:"guide-provider-codefresh",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-codefresh"},"Step for Codefresh"),(0,o.kt)("p",null,"  You need to define a few things in your ",(0,o.kt)("inlineCode",{parentName:"p"},".codefresh/codefresh.yml")," config file."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Define an API token (e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC"),") in the Codefresh dashboard. See left menu ",(0,o.kt)("i",null,"Pipelines -> settings (cog icon next to the pipeline) -> Variables tab (see a vertical menu on the right-hand side)"),". Add a new API token there depending on the test runner you use:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_CUCUMBER")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_MINITEST")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"KNAPSACK_PRO_TEST_SUITE_TEST_UNIT")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_SPINACH")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Set the Codefresh YAML file path. In the Codefresh dashboard, see left menu ",(0,o.kt)("em",{parentName:"p"},"Pipelines -> settings (cog icon next to pipeline) -> Workflow tab (horizontal menu on the top) -> Path to YAML")," (set: ",(0,o.kt)("inlineCode",{parentName:"p"},"./.codefresh/codefresh.yml"),").")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Define how many parallel jobs (parallel CI nodes) you want to run with the ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_CI_NODE_TOTAL")," environment variable in the ",(0,o.kt)("inlineCode",{parentName:"p"},".codefresh/codefresh.yml")," file.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Ensure that in the ",(0,o.kt)("inlineCode",{parentName:"p"},"matrix")," section, you listed all ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_CI_NODE_INDEX")," environment variables with values from ",(0,o.kt)("inlineCode",{parentName:"p"},"0")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_CI_NODE_TOTAL-1"),". Codefresh will generate a matrix of parallel jobs, with each job having a distinct value for the ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_CI_NODE_INDEX")," variable. This is needed for Knapsack Pro to work correctly."),(0,o.kt)("p",{parentName:"li"},"Below you can find an example Codefresh YAML config and ",(0,o.kt)("inlineCode",{parentName:"p"},"Test.Dockerfile")," used by Codefresh to run Ruby on Rails project with PostgreSQL in a Docker container."),(0,o.kt)("p",{parentName:"li"},"Add ",(0,o.kt)("inlineCode",{parentName:"p"},".codefresh/codefresh.yml")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Test.Dockerfile")," files to your project repository."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'{% raw %}\n# .codefresh/codefresh.yml\nversion: "1.0"\n\nstages:\n- "clone"\n- "build"\n- "tests"\n\nsteps:\nmain_clone:\n  type: "git-clone"\n  description: "Cloning main repository..."\n  repo: "${{CF_REPO_OWNER}}/${{CF_REPO_NAME}}"\n  revision: "${{CF_BRANCH}}"\n  stage: "clone"\nBuildTestDockerImage:\n  title: Building Test Docker image\n  type: build\n  arguments:\n    image_name: \'${{CF_ACCOUNT}}/${{CF_REPO_NAME}}-test\'\n    tag: \'${{CF_BRANCH_TAG_NORMALIZED}}-${{CF_SHORT_REVISION}}\'\n    dockerfile: Test.Dockerfile\n  stage: "build"\n\nrun_tests:\n  stage: "tests"\n  image: \'${{BuildTestDockerImage}}\'\n  working_directory: /src\n  fail_fast: false\n  environment:\n    - RAILS_ENV=test\n    # set how many parallel jobs you want to run\n    - KNAPSACK_PRO_CI_NODE_TOTAL=2\n    - PGHOST=postgres\n    - PGUSER=rails-app-with-knapsack_pro\n    - PGPASSWORD=password\n  services:\n    composition:\n      postgres:\n        image: postgres:latest\n        environment:\n          - POSTGRES_DB=rails-app-with-knapsack_pro_test\n          - POSTGRES_PASSWORD=password\n          - POSTGRES_USER=rails-app-with-knapsack_pro\n        ports:\n          - 5432\n  matrix:\n    environment:\n      # please ensure you list indexes from 0 to N-1,\n      # where N is the value of KNAPSACK_PRO_CI_NODE_TOTAL\n      - KNAPSACK_PRO_CI_NODE_INDEX=0\n      - KNAPSACK_PRO_CI_NODE_INDEX=1\n  commands:\n    - bin/rails db:prepare\n\n    # run tests in Knapsack Pro Regular Mode\n    - bundle exec rake knapsack_pro:rspec\n    - bundle exec rake knapsack_pro:cucumber\n    - bundle exec rake knapsack_pro:minitest\n    - bundle exec rake knapsack_pro:test_unit\n    - bundle exec rake knapsack_pro:spinach\n\n    # you can use Knapsack Pro in Queue Mode once you recorded the CI build in the Regular Mode\n    - bundle exec rake knapsack_pro:queue:rspec\n    - bundle exec rake knapsack_pro:queue:cucumber\n    - bundle exec rake knapsack_pro:queue:minitest\n{% endraw %}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"# Test.Dockerfile\nFROM ruby:2.6.5-alpine3.10\n\n# Prepare Docker image for Nokogiri\nRUN apk add --update \\\nbuild-base \\\nlibxml2-dev \\\nlibxslt-dev \\\njq \\\nnodejs \\\nnpm \\\npostgresql-dev \\\npython3-dev \\\nsqlite-dev \\\ngit \\\n&& rm -rf /var/cache/apk/*\n\n# Install AWS CLI\nRUN pip3 install awscli\n\n# Use libxml2, libxslt packages from alpine for building nokogiri\nRUN bundle config build.nokogiri --use-system-libraries\n\n# Install Codefresh CLI\nRUN wget https://github.com/codefresh-io/cli/releases/download/v0.31.1/codefresh-v0.31.1-alpine-x64.tar.gz\nRUN tar -xf codefresh-v0.31.1-alpine-x64.tar.gz -C /usr/local/bin/\n\nCOPY . /src\n\nWORKDIR /src\n\nRUN bundle install\n"))),(0,o.kt)("div",{id:"guide-provider-other",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"step-for-other-ci-providers"},"Step for other CI providers"),(0,o.kt)("p",null,"Set the following global variables on your CI server."),(0,o.kt)("p",null,"The CI server's git installation will be used to determine the branch name and current commit hash (those values are needed for Knapsack Pro)."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"KNAPSACK_PRO_REPOSITORY_ADAPTER=git\n")),(0,o.kt)("p",null,"The path to the project repository on your CI server, for instance:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"KNAPSACK_PRO_PROJECT_DIR=/home/ubuntu/my-app-repository\n")),(0,o.kt)("p",null,"You can ",(0,o.kt)("a",{href:"https://github.com/KnapsackPro/knapsack_pro-ruby#repository-adapter-how-to-set-up-3-of-3",target:"_blank"},"learn more about those variables here")," and see what to do when you don't use git."),(0,o.kt)("h3",{id:"set-api-token"},"Set API token"),(0,o.kt)("p",null,"You must set a separate API token on your CI server for each test suite you use:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC\n")),(0,o.kt)("p",null,"You can generate more API tokens in your ",(0,o.kt)("a",{href:"https://knapsackpro.com/dashboard",target:"_blank"},"Knapsack Pro User Dashboard")),(0,o.kt)("h3",{id:"run-tests-on-your-ci-servers"},"Run tests on your CI servers"),(0,o.kt)("p",null,"You need to configure a command responsible for running tests on each CI node.",(0,o.kt)("br",null),"Let's assume you have 2 CI nodes. Here are the commands you need to run for each CI node."),(0,o.kt)("p",null,"Step for RSpec"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Command for the first CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:rspec\n\n# Command for the second CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:rspec\n")),(0,o.kt)("p",null,"Step for Minitest"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Command for the first CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:minitest\n\n# Command for the second CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:minitest\n")),(0,o.kt)("p",null,"Step for test-unit"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Command for the first CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:test_unit\n\n# Command for the second CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:test_unit\n")),(0,o.kt)("p",null,"Step for Cucumber"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Command for the first CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:cucumber\n\n# Command for the second CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:cucumber\n")),(0,o.kt)("p",null,"Step for spinach"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Command for the first CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:spinach\n\n# Command for the second CI node\nKNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:spinach\n")),(0,o.kt)("p",null,"If you have more CI nodes, then update accordingly:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-plain"},"KNAPSACK_PRO_CI_NODE_TOTAL - the total number of your CI nodes\nKNAPSACK_PRO_CI_NODE_INDEX - the index of each CI node (starting from 0)\n")))),(0,o.kt)("div",{id:"guide-final-step",className:"hidden",markdown:"1"},(0,o.kt)("h3",{id:"verify-that-everything-works-in-regular-mode-step-1-out-of-3"},"Verify that everything works in Regular Mode (step 1 out of 3)"),(0,o.kt)("p",null,"You are now ready to use the gem!"),(0,o.kt)("p",null,"Please push a new commit to your repository so that the knapsack_pro gem records the execution time of your test suite. Note that the first run will not be optimal because knapsack_pro needs first to record execution data."),(0,o.kt)("p",null,"Visit the ",(0,o.kt)("a",{href:"https://knapsackpro.com/dashboard",target:"_blank"},"user dashboard")," and click the ",(0,o.kt)("b",null,"Show build metrics")," button next to your API token. Click ",(0,o.kt)("b",null,"Show")," on the new build and ensure the data from all of your CI nodes has been recorded. You should see a confirmation that all of your parallel nodes have finished their work."),(0,o.kt)("p",null,(0,o.kt)("strong",null,"The next test suite run on your CI will be parallelized optimally if the previous one has been recorded correctly.")),(0,o.kt)("h3",{id:"consider-using-the-queue-mode-to-balance-work-dynamically-across-ci-nodes-step-2-out-of-3"},"Consider using the Queue Mode to balance work dynamically across CI nodes (step 2 out of 3)"),(0,o.kt)("p",null,"Once you confirm the knapsack_pro Regular Mode works and your tests are green, you may want to ",(0,o.kt)("a",{href:"https://github.com/KnapsackPro/knapsack_pro-ruby#queue-mode",target:"_blank"},"learn about Queue Mode and how to use it"),"."),(0,o.kt)("p",null,"  ",(0,o.kt)("strong",{parentName:"p"},"Please ensure you explicitly set ",(0,o.kt)("inlineCode",{parentName:"strong"},"RAILS_ENV=test")," on your CI nodes. You can add this setting to your CI environment variables configuration. It is needed for the Queue Mode to run correctly.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Example command for the Regular Mode in RSpec\nbundle exec rake knapsack_pro:rspec\n\n# Example command for the Queue Mode in RSpec >= 3.x\nbundle exec rake knapsack_pro:queue:rspec\n\n# Example command for the Queue Mode in Minitest\nbundle exec rake knapsack_pro:queue:minitest\n\n# Example command for the Queue Mode in Cucumber\n# If you use the spring gem and spring-commands-cucumber gem to start Cucumber tests faster, please set:\n# export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bundle exec spring\n# or alternatively you can use spring binstub:\n# export KNAPSACK_PRO_CUCUMBER_QUEUE_PREFIX=bin/spring\n# Thanks to that, Cucumber will start tests faster for each batch of tests fetched from the Knapsack Pro Queue API\nbundle exec rake knapsack_pro:queue:cucumber\n")),(0,o.kt)("p",null,"  We recommend using the Regular Mode first in order to record execution data for your project. You could also use the Queue Mode to do that, but it will be much slower when recording your first build. Please ensure your tests are green in the Regular Mode and there are no order-dependent test failures before trying the Queue Mode."),(0,o.kt)("p",null,"  ",(0,o.kt)("strong",{parentName:"p"},"Note for the Queue Mode:")," if you use a CI provider that allows you to just retry a single CI node (for instance, Travis CI allows this when tests fail only on one of the parallel CI nodes), or when you use CI nodes on servers that can be killed during runtime (for instance using Buildkite with Amazon EC2 Spot Instances/Google Cloud Preemptible that can be preempted during CI run), then in the Queue Mode you need to set the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/KnapsackPro/knapsack_pro-ruby#knapsack_pro_fixed_queue_split-remember-queue-split-on-retry-ci-node"},(0,o.kt)("inlineCode",{parentName:"a"},"KNAPSACK_PRO_FIXED_QUEUE_SPLIT=true"))," flag in order to handle this correctly."),(0,o.kt)("p",null,"  ",(0,o.kt)("strong",{parentName:"p"},"An important step for CI providers that allow retrying single failed CI nodes (like Buildkite)"),": See ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/KnapsackPro/knapsack_pro-ruby#required-ci-configuration-if-you-use-retry-single-failed-ci-node-feature-on-your-ci-server-when-knapsack_pro_fixed_queue_splittrue-in-queue-mode-or-knapsack_pro_fixed_test_suite_splittrue-in-regular-mode"},"the required CI configuration if you retry single failed CI nodes on your CI server")," when using the ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_FIXED_QUEUE_SPLIT=true")," (for the Queue Mode) or the ",(0,o.kt)("inlineCode",{parentName:"p"},"KNAPSACK_PRO_FIXED_TEST_SUITE_SPLIT=true")," setting (for the Regular Mode)."),(0,o.kt)("p",null,"  ",(0,o.kt)("strong",{parentName:"p"},"Common problems with the Queue Mode"),": If you notice any test failures for RSpec when using the knapsack","_","pro Queue Mode, then it means that your test suite needs to be adjusted for using the ",(0,o.kt)("inlineCode",{parentName:"p"},"RSpec::Core::Runner")," multiple times (which is what the Queue Mode does). Please see our ",(0,o.kt)("a",{parentName:"p",href:"https://knapsackpro.com/faq/question/why-when-i-use-queue-mode-for-rspec-then-my-tests-fail"},"FAQ entry for common Queue Mode problems"),"."),(0,o.kt)("p",null,"  If you think your problem is not covered there, please ",(0,o.kt)("a",{parentName:"p",href:"https://knapsackpro.com/contact"},"contact us"),". We've seen many projects and realize that each test suite might introduce different edge cases that sometimes make RSpec fail. We'll be happy to help you debug yours!"),(0,o.kt)("p",null,"You can learn more about custom configuration and other ",(0,o.kt)("a",{href:"https://knapsackpro.com/features",target:"_blank"},"features")," from the ",(0,o.kt)("a",{href:"https://github.com/KnapsackPro/knapsack_pro-ruby#table-of-contents",target:"_blank"},"documentation"),". If you have any problems, please check our ",(0,o.kt)("a",{href:"https://knapsackpro.com/faq",target:"_blank"},"FAQ"),"."),(0,o.kt)("p",null,"Many people look for information on using the ",(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/how-to-use-junit-formatter",target:"_blank"},"junit formatter")," with RSpec or Cucumber or how to use ",(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/how-to-use-codeclimate-with-knapsack_pro",target:"_blank"},"CodeClimate")," or ",(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/how-to-use-simplecov-in-queue-mode",target:"_blank"},"SimpleCov")," with the knapsack_pro gem."),(0,o.kt)("p",null,"Feel free to ",(0,o.kt)("a",{href:"https://knapsackpro.com/contact",target:"_blank"},"reach out")," if you need any help."),(0,o.kt)("h3",{id:"how-to-split-slow-test-files-across-parallel-ci-nodes-step-3-out-of-3"},"How to split slow test files across parallel CI nodes (step 3 out of 3)"),(0,o.kt)("p",null,"If your test suite has very slow test files then the ",(0,o.kt)("a",{href:"https://github.com/KnapsackPro/knapsack_pro-ruby#split-test-files-by-test-cases",target:"_blank"},"slowest test files can be split across parallel CI nodes automatically by the knapsack_pro gem"),". This works both in the Regular Mode and the Queue Mode."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# enable split by test examples for the slowest RSpec test files\nKNAPSACK_PRO_RSPEC_SPLIT_BY_TEST_EXAMPLES=true\n")),(0,o.kt)("p",null,"If you'd like to limit the debug logs produced by the knapsack_pro gem, you can change the log level to:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"KNAPSACK_PRO_LOG_LEVEL=info\n")),(0,o.kt)("p",null,"You can learn more ",(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/how-can-i-change-log-level",target:"_blank"},"here"),"."),(0,o.kt)("h3",{id:"most-popular-faq-entries"},"Most popular FAQ entries"),(0,o.kt)("p",null,"You can find all entries in the ",(0,o.kt)("a",{href:"https://knapsackpro.com/faq",target:"_blank"},"FAQ"),". The following are the most popular things developers ask about."),(0,o.kt)("ul",null,(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/why-when-i-use-queue-mode-for-rspec-then-my-tests-fail",target:"_blank"},"RSpec tests failing in the Queue Mode")),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://github.com/KnapsackPro/knapsack_pro-ruby#knapsack_pro_fixed_queue_split-remember-queue-split-on-retry-ci-node",target:"_blank"},"Retrying a single failed CI node in the Queue Mode")," - If your CI provider allows retrying just a single CI node, then you should set KNAPSACK_PRO_FIXED_QUEUE_SPLIT=true to allow Knapsack Pro to remember what tests were executed on the particular CI node."),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/why-knapsack_pro-hangs--freezes--is-stale-ie-for-codeship-in-queue-mode",target:"_blank"},"CI tests output freezing")),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/how-to-use-junit-formatter",target:"_blank"},"Using JUnit formatter with Knapsack Pro")),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/how-to-use-simplecov-in-queue-mode",target:"_blank"},"Using simplecov in the Queue Mode")),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/how-to-use-codeclimate-with-knapsack_pro",target:"_blank"},"Using CodeClimate with Knapsack Pro")),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://github.com/KnapsackPro/knapsack_pro-ruby#test-file-names-encryption",target:"_blank"},"Encrypting test file names for Ruby tests")),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/what-data-is-sent-to-your-servers",target:"_blank"},"Questions around data usage and security")," - Knapsack Pro does not have access to your project source code. It collects only branch names, git commit hashes and test file paths along with their execution time."),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/how-can-i-run-tests-from-multiple-directories",target:"_blank"},"Running selected tests based on a pattern")," - set the KNAPSACK_PRO_TEST_FILE_PATTERN instead of passing the --pattern option to RSpec"),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/how-to-run-a-specific-list-of-test-files-or-only-some-tests-from-test-file",target:"_blank"},"Running a specific list of test files or only some test examples")),(0,o.kt)("li",null,(0,o.kt)("a",{href:"https://knapsackpro.com/faq/question/how-to-exclude-tests-from-running-them",target:"_blank"},"Excluding selected tests")))))}_.isMDXComponent=!0}}]);