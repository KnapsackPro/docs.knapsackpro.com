"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[426],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>k});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),c=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=c(e.components);return a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),m=c(n),k=r,d=m["".concat(p,".").concat(k)]||m[k]||u[k]||l;return n?a.createElement(d,i(i({ref:t},s),{},{components:n})):a.createElement(d,i({ref:t},s))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=m;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var c=2;c<l;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9089:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const l={pagination_next:null,pagination_prev:null},i="Test files and branch names encryption",o={unversionedId:"ruby/encryption",id:"ruby/encryption",title:"Test files and branch names encryption",description:"Knapsack Pro collects a minimal amount of data about your project:",source:"@site/docs/ruby/encryption.md",sourceDirName:"ruby",slug:"/ruby/encryption",permalink:"/ruby/encryption",draft:!1,editUrl:"https://github.com/KnapsackPro/docs.knapsackpro.com/tree/main/docusaurus/docs/ruby/encryption.md",tags:[],version:"current",frontMatter:{pagination_next:null,pagination_prev:null},sidebar:"sidebar"},p={},c=[{value:"Enable encryption",id:"enable-encryption",level:2},{value:"Caveats",id:"caveats",level:2},{value:"Debug test file names",id:"debug-test-file-names",level:2},{value:"Debug branch names",id:"debug-branch-names",level:2}],s={toc:c};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"test-files-and-branch-names-encryption"},"Test files and branch names encryption"),(0,r.kt)("p",null,"Knapsack Pro collects a minimal amount of data about your project:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"File paths of your tests (e.g., ",(0,r.kt)("inlineCode",{parentName:"li"},"spec/models/user_spec.rb"),")"),(0,r.kt)("li",{parentName:"ul"},"Branch name"),(0,r.kt)("li",{parentName:"ul"},"Commit hash"),(0,r.kt)("li",{parentName:"ul"},"Number of parallel CI nodes"),(0,r.kt)("li",{parentName:"ul"},"CI node index"),(0,r.kt)("li",{parentName:"ul"},"Tests execution time")),(0,r.kt)("p",null,"If you consider test file names or branch names sensitive data, you can encrypt them with ",(0,r.kt)("inlineCode",{parentName:"p"},"Digest::SHA2.hexdigest")," and a 64-char salt before they are sent to the Knapsack Pro API. Thanks to the salt, only you will be able to decrypt test file names or branch names."),(0,r.kt)("h2",{id:"enable-encryption"},"Enable encryption"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://knapsackpro.com/dashboard"},"Generate")," a new API token (do not use the same token for encrypted and non-encrypted runs)"),(0,r.kt)("li",{parentName:"ul"},"Create a salt with ",(0,r.kt)("inlineCode",{parentName:"li"},"bundle exec rake knapsack_pro:salt")),(0,r.kt)("li",{parentName:"ul"},"Pass the salt to Knapsack Pro with ",(0,r.kt)("a",{parentName:"li",href:"/ruby/reference/#knapsack_pro_salt"},(0,r.kt)("inlineCode",{parentName:"a"},"KNAPSACK_PRO_SALT"))),(0,r.kt)("li",{parentName:"ul"},"Enable test file names encryption with ",(0,r.kt)("a",{parentName:"li",href:"/ruby/reference/#knapsack_pro_test_files_encrypted"},(0,r.kt)("inlineCode",{parentName:"a"},"KNAPSACK_PRO_TEST_FILES_ENCRYPTED=true"))),(0,r.kt)("li",{parentName:"ul"},"Enable branch name encryption with ",(0,r.kt)("a",{parentName:"li",href:"/ruby/reference/#knapsack_pro_branch_encrypted"},(0,r.kt)("inlineCode",{parentName:"a"},"KNAPSACK_PRO_BRANCH_ENCRYPTED=true")))),(0,r.kt)("h2",{id:"caveats"},"Caveats"),(0,r.kt)("p",null,"When you enable encryption, your first test suite split will not be optimal because Knapsack Pro needs to map encrypted test file names to test timings again."),(0,r.kt)("p",null,"Also, note that the following branch names won't be encrypted to allow the Knapsack Pro API to determine timings for test files on newly created branches:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"master")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"main")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"develop")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"development")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"dev")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"staging")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"production")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/KnapsackPro/knapsack_pro-ruby/blob/master/lib/knapsack_pro/crypto/branch_encryptor.rb"},"full list")," of non-encryptable branches")),(0,r.kt)("h2",{id:"debug-test-file-names"},"Debug test file names"),(0,r.kt)("p",null,"You can check what's the hash of a particular test file name with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'KNAPSACK_PRO_SALT=MY_SALT bundle exec rake "knapsack_pro:encrypted_test_file_names[rspec]"\n')),(0,r.kt)("p",null,"Pass your test runner to the rake task (e.g., ",(0,r.kt)("inlineCode",{parentName:"p"},"rspec"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"minitest"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"test_unit"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"cucumber"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"spinach"),")."),(0,r.kt)("h2",{id:"debug-branch-names"},"Debug branch names"),(0,r.kt)("p",null,"You can check what's the hash of a particular branch name with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'# All local branches\nKNAPSACK_PRO_SALT=MY_SALT bundle exec rake knapsack_pro:encrypted_branch_names\n\n# Specific branch\nKNAPSACK_PRO_SALT=MY_SALT bundle exec rake "knapsack_pro:encrypted_branch_names[MY_UNENCRYPTED_BRANCH_NAME]"\n')))}u.isMDXComponent=!0}}]);