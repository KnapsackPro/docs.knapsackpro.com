---
pagination_next: null
pagination_prev: null
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Hooks: Before and After

:::caution

Knapsack Pro hooks are only available in [Queue Mode](../overview/index.mdx#queue-mode-dynamic-split).

:::

:::caution

If you are using RSpec or `percy-capybara`, read the dedicated sections below.

:::

Knapsack exposes four hooks to execute arbitrary code before or after certain events:

```ruby
KnapsackPro::Hooks::Queue.before_queue do |queue_id|
  puts 'before_queue - run before the test suite'
end

KnapsackPro::Hooks::Queue.before_subset_queue do |queue_id, subset_queue_id|
  puts 'before_subset_queue - run before the next subset of tests'
end

KnapsackPro::Hooks::Queue.after_subset_queue do |queue_id, subset_queue_id|
  puts 'after_subset_queue - run after the previous subset of tests'
end

KnapsackPro::Hooks::Queue.after_queue do |queue_id|
  puts 'after_queue - run after the test suite'
end
```

## `percy-capybara`

### `percy-capybara` >= 4

If you are using Knapsack Pro in Queue Mode with `percy-capybara` >= 4, you need to configure the environment variables as explained in [Percy's docs](https://docs.percy.io/docs/parallel-test-suites#section-manual-configuration-with-environment-variables).

After that, you can use the following command:

```bash
npx percy exec --parallel -- rake knapsack_pro:queue:rspec
# or with the knapsack_pro binary
npx percy exec --parallel -- knapsack_pro queue:rspec
```

Here you can find the docs for the [`knapsack_pro` binary](cookbook.md#use-the-knapsack-pro-binary).
